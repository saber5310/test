<!DOCTYPE html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>تفاصيل المباراة</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="api-football.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
        <!-- Google AdSense -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
    </head>
    <body>
        <header>
            <h1><a href="index.html"><i class="fas fa-arrow-right"></i> رجوع</a></h1>
        </header>

        <div id="match-details-container">
            <div class="loading">جاري تحميل تفاصيل المباراة...</div>
        </div>

        <div class="ad-container">
            <!-- Google AdSense -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                 data-ad-slot="XXXXXXXXXX"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <footer>
            <div class="footer-links">
                <a href="privacy.html">سياسة الخصوصية</a>
                <a href="terms.html">شروط الاستخدام</a>
                <a href="about.html">عن الموقع</a>
            </div>
            <div class="copyright">
                &copy; 2023 ليجا شوت. جميع الحقوق محفوظة.
            </div>
        </footer>

        <script>
            // دالة لجلب تفاصيل المباراة
            async function fetchMatchDetails() {
                const fixtureId = new URLSearchParams(window.location.search).get('id');
                if (!fixtureId) {
                    document.getElementById('match-details-container').innerHTML = 
                        '<div class="error">لم يتم توفير معرف المباراة</div>';
                    return;
                }

                const apiKey = '376800a4f1a5582465b88e9c37d3f326';
                const url = `https://v3.football.api-sports.io/fixtures?id=${fixtureId}`;
                
                try {
                    const response = await fetch(url, {
                        headers: {
                            'x-rapidapi-key': apiKey,
                            'x-rapidapi-host': 'v3.football.api-sports.io'
                        }
                    });
                    const data = await response.json();
                    displayMatchDetails(data.response[0]);
                } catch (error) {
                    console.error('Error fetching match details:', error);
                    document.getElementById('match-details-container').innerHTML = 
                        '<div class="error">فشل تحميل تفاصيل المباراة. يرجى المحاولة لاحقاً.</div>';
                }
            }

            // دالة لعرض تفاصيل المباراة
            function displayMatchDetails(match) {
                const container = document.getElementById('match-details-container');
                const matchDate = new Date(match.fixture.timestamp * 1000);
                const matchTime = matchDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const matchDateFormatted = matchDate.toLocaleDateString('ar-EG');

                // تحضير أحداث المباراة
                let eventsHtml = '';
                if (match.events && match.events.length > 0) {
                    eventsHtml = '<h3><i class="fas fa-list"></i> أحداث المباراة</h3><div class="events-container">';
                    match.events.forEach(event => {
                        eventsHtml += `
                            <div class="event">
                                <span class="event-time">${event.time.elapsed}'</span>
                                <span class="event-type ${event.type.toLowerCase()}">${getEventTypeInArabic(event.type)}</span>
                                <span class="event-team">${event.team.name}</span>
                                <span class="event-player">${event.player.name}</span>
                                ${event.detail === 'Normal Goal' ? '⚽' : ''}
                                ${event.detail === 'Yellow Card' ? '🟨' : ''}
                                ${event.detail === 'Red Card' ? '🟥' : ''}
                                ${event.detail === 'Penalty' ? '⏏️' : ''}
                            </div>
                        `;
                    });
                    eventsHtml += '</div>';
                }

                // تحضير إحصائيات المباراة
                let statsHtml = '';
                if (match.statistics && match.statistics.length > 0) {
                    statsHtml = '<h3><i class="fas fa-chart-bar"></i> إحصائيات المباراة</h3><div class="stats-container">';
                    
                    const homeStats = match.statistics.find(s => s.team.id === match.teams.home.id);
                    const awayStats = match.statistics.find(s => s.team.id === match.teams.away.id);
                    
                    if (homeStats && awayStats) {
                        statsHtml += `
                            <table>
                                <thead>
                                    <tr>
                                        <th>الإحصائية</th>
                                        <th>${match.teams.home.name}</th>
                                        <th>${match.teams.away.name}</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        
                        const importantStats = ['Total Shots', 'Shots on Goal', 'Shots off Goal', 'Shots Insidebox', 
                                              'Shots Outsidebox', 'Ball Possession', 'Corner Kicks', 'Fouls', 
                                              'Goalkeeper Saves', 'Passes accurate', 'Passes %'];
                        
                        homeStats.statistics.forEach((stat, index) => {
                            const awayStat = awayStats.statistics[index];
                            if (importantStats.includes(stat.type)) {
                                statsHtml += `
                                    <tr>
                                        <td>${getStatInArabic(stat.type)}</td>
                                        <td>${stat.value}</td>
                                        <td>${awayStat.value}</td>
                                    </tr>
                                `;
                            }
                        });
                        
                        statsHtml += `
                                </tbody>
                            </table>
                        `;
                    }
                    
                    statsHtml += '</div>';
                }

                container.innerHTML = `
                    <div class="match-details-card">
                        <div class="league-info">
                            <img src="${match.league.logo}" alt="${match.league.name}" class="league-logo" loading="lazy">
                            <span>${match.league.name} - ${match.league.round}</span>
                        </div>
                        
                        <div class="match-header">
                            <div class="match-date"><i class="far fa-calendar-alt"></i> ${matchDateFormatted} - ${matchTime}</div>
                            <div class="match-venue"><i class="fas fa-map-marker-alt"></i> ${match.fixture.venue.name}, ${match.fixture.venue.city}</div>
                            <div class="match-status ${getStatusClass(match.fixture.status.short)}">
                                ${getStatusInArabic(match.fixture.status.long)}
                            </div>
                        </div>
                        
                        <div class="teams-details">
                            <div class="team-detail home-team">
                                <img src="${match.teams.home.logo}" alt="${match.teams.home.name}" class="team-logo-large" loading="lazy">
                                <span class="team-name">${match.teams.home.name}</span>
                                <span class="team-score">${match.goals.home}</span>
                            </div>
                            
                            <div class="vs-details">
                                <span>VS</span>
                            </div>
                            
                            <div class="team-detail away-team">
                                <span class="team-score">${match.goals.away}</span>
                                <img src="${match.teams.away.logo}" alt="${match.teams.away.name}" class="team-logo-large" loading="lazy">
                                <span class="team-name">${match.teams.away.name}</span>
                            </div>
                        </div>
                        
                        ${eventsHtml}
                        ${statsHtml}
                        
                        <div class="match-officials">
                            <h3><i class="fas fa-whistle"></i> حكام المباراة</h3>
                            <div class="referees">
                                ${match.fixture.referee ? `<div><i class="fas fa-user"></i> الحكم: ${match.fixture.referee}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            // دالة للحصول على كلاس حالة المباراة
            function getStatusClass(status) {
                const statusMap = {
                    'FT': 'finished',
                    'HT': 'inprogress',
                    '1H': 'inprogress',
                    '2H': 'inprogress',
                    'NS': 'scheduled',
                    'PST': 'postponed',
                    'CANC': 'cancelled'
                };
                return `status-${statusMap[status] || 'scheduled'}`;
            }

            // دالة لترجمة حالة المباراة
            function getStatusInArabic(status) {
                const statusMap = {
                    'Match Finished': 'انتهت المباراة',
                    'First Half': 'الشوط الأول',
                    'Halftime': 'استراحة',
                    'Second Half': 'الشوط الثاني',
                    'Not Started': 'لم تبدأ بعد',
                    'Match Postponed': 'مؤجلة',
                    'Match Cancelled': 'ملغاة'
                };
                return statusMap[status] || status;
            }

            // دالة لترجمة نوع الحدث
            function getEventTypeInArabic(type) {
                const typeMap = {
                    'Goal': 'هدف',
                    'Card': 'بطاقة',
                    'subst': 'تبديل'
                };
                return typeMap[type] || type;
            }

            // دالة لترجمة الإحصائيات
            function getStatInArabic(stat) {
                const statMap = {
                    'Total Shots': 'إجمالي التسديدات',
                    'Shots on Goal': 'تسديدات على المرمى',
                    'Shots off Goal': 'تسديدات خارج المرمى',
                    'Shots Insidebox': 'تسديدات داخل الصندوق',
                    'Shots Outsidebox': 'تسديدات خارج الصندوق',
                    'Ball Possession': 'الاستحواذ',
                    'Corner Kicks': 'ركنيات',
                    'Fouls': 'أخطاء',
                    'Goalkeeper Saves': 'تصديات الحارس',
                    'Passes accurate': 'تمريرات ناجحة',
                    'Passes %': 'نسبة التمريرات'
                };
                return statMap[stat] || stat;
            }

            // جلب تفاصيل المباراة عند تحميل الصفحة
            document.addEventListener('DOMContentLoaded', fetchMatchDetails);
        </script>
    </body>
</html>
